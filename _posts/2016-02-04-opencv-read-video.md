---
title: vs2010下面编译过的opencv程序搬到新的笔记本上运行不了
layout: post
tags:
  - programming
---

#### 问题背景

山川硬是想要自己来运行我的程序，明明已经拜托外包公司给整合成软件了，还是要源码，给了之后说看不懂不会运行，非要我编译好一个exe双击完成一切工作的东西来。太tm蛋疼了。

没办法，参数太多就弄一个.bat文件让他双击去。结果，移动到他专用的笔记本上之后，完全运行不了。那个笔记本，买过来之后除了自带的系统之外，毛都没有，卖摄像头的公司来给装了驱动，然后就什么都没有动过。连个杀毒软件都没有，浏览器也只能靠ie。然后昨天开完会，那家伙厚着脸皮要把笔记本放到我这里，要我调好可运行的程序为止。

这家伙就是每次搞搞摄影，然后拍出来的视频拿过来让我处理，处理完之后，刚开始连excel都不愿意处理，而且那时候也不会，后来，他老板怒了，不知道问谁帮忙处理了一下数据，画出个直方图之类的。一次开会的时候直方图还是错的，会议的后半部分，全是他老板当着我的面批斗山川了，我当时就想，你们内部的事情等我走了处理去，tm的演给我看呢。

跑题了，这次要总结的是新笔记本上的程序调试。刚开始是师弟倒腾的mfc，把我的处理代码全部放进到button的click事件，而不是用消息控制，理论上，如果没有其他错误，只会造成程序假死，但是处理还是能够处理的。可是实际问题是，一步一步按照错误提示复制过去所有mfc用到的dll之后，在程序卡死的过程中还压根没有处理任何一帧图像，全黑全黑的。

帮师弟找了很久mfc的责任，最终对mfc失望。所以去繁就简，毅然决然选择用一个命令行，不要什么界面了。命令行弄出来之后还是缺失dll之类的，复制过去opencv的所有用到的dll。依然不行，没有提示错误，但是程序读取视频发现读取到的是全黑的图像，明显没有读到内容呀。

#### 解决方案

一度失去信心，觉得这么些破事，其实我完全可以置之不理。但是下那个决定的第二天来到之后，还是凭着爱折腾的精神去重新鼓捣一下那个东西，去网上搜。发现有论坛说，要保证新笔记本安装好ffmpeg。然后就想办法去安装，下载static的binary，32位跟64位都试了，没有卵用。

后来看到一篇csdn的博客 [链接](http://blog.csdn.net/andrewseu/article/details/49100093)，说是，把opencv里面的opencv_ffmpeg_64.dll复制到python安装路径里面去。就试试，博客里面说得很乱，一个新的笔记本环境连opencv都没有装，怎么会有python的路径。

发现引用的英文论坛说明上写的是 系统path包含的路径。

所以我自己的解决方案，就是

> 1. 复制opencv/sources/3rdparty/ffmpeg/文件夹下面两个名字跟ffmpeg相关的dll, 到新笔记本的编译exe同一文件夹下.
> 2. 改名字: 两个dll都加上opencv的版本号, 我用的是opencv2.4.9, 所以名字就是opencv_ffmpeg_64.dll改为opencv_ffmpeg249_64.dll, 另外一个同理
> 3. 效果就是命令行版本的exe可以正常运行. 然后就把这两个dll也复制到mfc版本里面去, 发现也是可以正常截图处理的, 虽然有假死, 但是没关系,将就用吧.

#### 最近感悟

昨天一个软件外包公司的负责人来要问我源代码是怎么个情况, 参数怎么调整, 什么运行模式, 为什么我计算的运行时间比他尝试的少那么多. 一切都解释清楚之后, 他要给我演示一下他做出来的软件雏形, 刚开始问拿什么做的,还不是很愿意说,一副保密的样子, 只跟我透漏c#做的, 我就问win form还是wpf, 终究还是承认了. win form的界面. 然后用了哪些插件去完成excel同样的处理能力, 做了多少个界面完成双方都很happy的处理。他虽然有炫耀的嫌疑，只是感觉他总是有意无意提到我也能做到同样的事情，或许是恭维，或许是害怕我是行家吧。 其实我真不能算是行家，大学时候是拼命追求软件界面完美，用c#体会编程之美的最疯狂时期，还做了一个软件参加比赛，但是那时候紧张，也不太会表达，很多人都不理解我做的软件哪里优秀，哪里是难突破的地方，所以比赛之后就停步了，要发论文就把主要精力放到matlab上面了。去年，因为项目需要，又重新学了一下vb的winform控制，做了个小软件给他们摄影实验用。所以那外包公司的人也没必要对我遮遮掩掩怕我跟我老板说点什么不利于他们的报酬。开会的时候，他们当着我的面，也不是很好意思抬高要价，其实没必要。我可能费点功夫也能做出来，但是从我的身份出发，老板还是只会给我每月的工资，没有其他的。他们的位置不一样啊，委托一个别的公司，当然要另批出一部分资金了。所以，我即便知道这个东西费多大功夫，应该付多少钱，我也没必要去给老板透个底压价。有时候都在怀疑，程序员都在干什么事情，不就是搬运工吗，从一个技术里面拿一块，另一个领域里面抄一块，然后拼在一块，调试到能用，交差。真想不明白以前上学的时候听来学校讲座的某某是十几年的c++资深编程人员，既然是资深，那就是说，用的比较多，知道的比较丰富呗，也就是搬来搬去的工作重复的年份多呗，资深搬运工。然后煞有介事地给我们讲一些玄乎的方法论，结束时候，还没睡着的就没几个人了。其实交流还是很重要的，如果面对面，或者谈一些编程时候，更为实际，更有共鸣的东西的话。


